@page
@model DetailsModel
@{
    List<float> values = new List<float>();
    List<DateTime> dates = new List<DateTime>();
    string valuteName = " ";
}
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - DSRProject</title>
    @* <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" /> *@
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    @* <script type="text/javascript" src="http://www.chartjs.org/assets/Chart.js"></script> *@
</head>

<div class="text-center">
    @if(Model.Courses.Count() == 0) {
        <p> No data </p>
    }
    <ul class="list-group">
        <p>@Model.Courses.ElementAt(0).Valute.Name</p>
        <table class="table table-striped">
            <thead>
                <tr>
                <th scope="col">Дата</th>
                <th scope="col">Курс</th>
                </tr>
            </thead>
            @foreach (var course in Model.Courses) {
            @* <div class="form-check" style="display: flex"> *@
                @* <p>@course.Valute.Name</p>
                <p>@course.Value</p> *@
                    <tbody>
                        <tr>
                        <th scope="row">@course.Date.ToShortDateString()</th>
                        <td>@course.Value</td>
                        </tr>
                    </tbody>
                @* @{ *@
                    values.Add(@course.Value);
                    dates.Add(@course.Date);
                    valuteName = @course.Valute.Name;
                }
                </table>
            @* </div> *@
    </ul>
    <div id = "test"></div>
    <div class="container my-4">
        <div>
            <canvas id="lineChart"></canvas>
        </div>
    </div>
</div>
<script>
    $(document).ready(function() {
        @* var a = Math.floor(@message); *@
        var valuesArray = [];
        var datesArray = [];
        @foreach (var d in values)
        {
            @:valuesArray.push("@d".replace(",", "."));
        }
        @foreach (var d in dates)
        {
            @:datesArray.push("@d".split(' ')[0]);
        }
        var sequence = '@valuteName'
        var spaceIndex = sequence.indexOf(' ') / 7;
        var charCode = sequence.split(/[;\s]+/g)
            .filter((v) => v)
            .map((v) => Number.parseInt(v.replace(/&#/, '0')))
        var ASCIIName = String.fromCharCode(...charCode)
        var ASCIINameWithSpace = ASCIIName.substring(0, spaceIndex) + " " + ASCIIName.substring(spaceIndex, ASCIIName.length)
        console.log(ASCIINameWithSpace)
        @* console.log(@valuteName.ToString()); *@
        @* var i = 0;
        var v = '@message[0]'.replace(",", ".");
        console.log(v); *@
        @* var result = [];
        for (var i = 0; i < 3; i++) {
            console.log(i);
            var k = [@message[0]];
            var a = "";
            a = a.concat(k[0], ".", k[1]);
            var b = parseFloat(a);
            result[i] = b;
        }
        console.log(result); *@
        @* var t = [10, 20, 55, 102, 20, 25]; *@
        var ctxL = document.getElementById("lineChart").getContext('2d');
        var myLineChart = new Chart(ctxL, {
        type: 'line',
        data: {
            labels: datesArray.reverse(),
            datasets: [{
                label: ASCIINameWithSpace,
                data: valuesArray.reverse(),
                backgroundColor: [
                'rgba(105, 0, 132, .2)',
                ],
                borderColor: [
                'rgba(200, 99, 132, .7)',
                ],
                borderWidth: 2
            },
            @* {
                label: "My Second dataset",
                data: [28, 48, 40, 19, 86, 27, 90],
                backgroundColor: [
                'rgba(0, 137, 132, .2)',
                ],
                borderColor: [
                'rgba(0, 10, 130, .7)',
                ],
                borderWidth: 2
            } *@
            ]
        },
        options: {
            responsive: true
        }
    });
    });
</script>
@* <script>
    $(document).ready(function()) {
        alert("hhh");
    } *@
@* var ctxL = document.getElementById("lineChart").getContext('2d');
    var myLineChart = new Chart(ctxL, {
    type: 'line',
    data: {
        labels: ["January", "February", "March", "April", "May", "June", "July"],
        datasets: [{
            label: "My First dataset",
            data: [65, 59, 80, 81, 56, 55, 40],
            backgroundColor: [
            'rgba(105, 0, 132, .2)',
            ],
            borderColor: [
            'rgba(200, 99, 132, .7)',
            ],
            borderWidth: 2
        },
        {
            label: "My Second dataset",
            data: [28, 48, 40, 19, 86, 27, 90],
            backgroundColor: [
            'rgba(0, 137, 132, .2)',
            ],
            borderColor: [
            'rgba(0, 10, 130, .7)',
            ],
            borderWidth: 2
        }
        ]
    },
    options: {
        responsive: true
    }
}); *@
@* </script> *@